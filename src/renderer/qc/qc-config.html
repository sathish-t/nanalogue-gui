<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Content Security Policy restricting scripts and styles to same-origin. -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
  <title>QC Configuration - nanalogue-gui</title>
  <!-- Shared base styles and QC-specific styles. -->
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="qc.css">
</head>
<body>
  <!-- QC configuration page root container. -->
  <div id="qc-config-app">
    <!-- Header with back navigation and page title. -->
    <header>
      <button type="button" id="btn-back" class="back-button">&larr; Back</button>
      <h1>QC Configuration</h1>
    </header>

    <main>
      <!-- BAM source selection: local file or remote URL. -->
      <section class="config-section">
        <h2>BAM Source</h2>
        <!-- Reusable BAM source input with file/URL toggle. -->
        <bam-resource-input id="bam-source"></bam-resource-input>
      </section>

      <!-- Panel displaying metadata from the selected BAM file. -->
      <section class="config-section" id="file-info-section">
        <h2>File Info</h2>
        <div id="file-info-content">
          <p class="placeholder-text">Will load upon BAM file specification</p>
        </div>
      </section>

      <!-- Modification type filter (e.g. +T for basecalled-strand thymidine). -->
      <section class="config-section">
        <!-- Reusable modification filter input with validation. -->
        <mod-filter-input id="mod-filter"></mod-filter-input>
      </section>

      <!-- Optional genomic region to restrict QC analysis. -->
      <section class="config-section">
        <h2>Region <span class="optional">(optional)</span></h2>
        <label for="region" class="visually-hidden">Region</label>
        <input type="text" id="region" placeholder="e.g. chr3, chrI:1000-50000">
        <!-- Checkbox to restrict to reads fully spanning the region. -->
        <label class="checkbox-label" id="full-region-label">
          <input type="checkbox" id="full-region" disabled>
          Restrict to reads that pass through region completely
        </label>
        <!-- Optional sub-region to restrict modification filtering. -->
        <label for="mod-region" class="visually-hidden">Restrict mods to region</label>
        <h2>Restrict mods to region <span class="optional">(optional)</span></h2>
        <input type="text" id="mod-region" placeholder="e.g. chr3, chrI:2000-40000">
      </section>

      <!-- Read length histogram granularity selection. -->
      <section class="config-section">
        <h2>Read length histogram resolution</h2>
        <label for="read-length-granularity" class="visually-hidden">Read length histogram resolution</label>
        <select id="read-length-granularity">
          <option value="1">Very fine (1 bp)</option>
          <option value="10">Fine (10 bp)</option>
          <option value="100">Standard (100 bp)</option>
          <option value="1000" selected>Coarse (1000 bp)</option>
          <option value="10000">Very coarse (10 kb)</option>
        </select>
      </section>

      <!-- Percentage of reads to sample for QC analysis. -->
      <section class="config-section">
        <h2>Sample fraction</h2>
        <div class="input-with-unit">
          <label for="sample-fraction" class="visually-hidden">Sample fraction</label>
          <input type="number" id="sample-fraction" value="0.1" min="0.01" max="100" step="0.1">
          <span class="unit">%</span>
        </div>
        <p class="hint warning">On large files/regions, you must subsample to avoid program crashes or heavy data downloads from remote URLs.</p>
      </section>

      <!-- Window size for the windowed analogue density calculation. -->
      <section class="config-section">
        <h2>Window size <span class="optional">(for windowed density)</span></h2>
        <div class="input-with-unit">
          <label for="window-size" class="visually-hidden">Window size</label>
          <input type="number" id="window-size" value="300" min="10" max="10000" step="10">
          <span class="unit">bases of interest</span>
        </div>
        <p class="hint">Windows are counted in bases of interest (e.g., thymidines), not total genomic bases.</p>
      </section>

      <!-- Submit button to start QC generation; disabled until a BAM is selected. -->
      <div class="action-row">
        <button type="button" id="btn-generate" class="primary-button" disabled>Generate QC</button>
      </div>

      <!-- Full-screen loading overlay shown during QC data generation. -->
      <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Generating QC data...</p>
      </div>
    </main>
  </div>

  <!-- Dialog showing full BAM file metadata (contigs and modifications). -->
  <dialog id="more-info-dialog">
    <h2>BAM File Details</h2>
    <div id="more-info-content"></div>
    <button type="button" id="more-info-close" class="primary-button">Close</button>
  </dialog>

  <!-- Bundled QC configuration script handling form interactions and IPC. -->
  <script src="qc-config.js"></script>
</body>
</html>
